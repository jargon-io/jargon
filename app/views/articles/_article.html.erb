<%# locals: (article:, show_searches: false) %>
<div id="<%= dom_id(article) %>" class="border rounded-lg p-5 transition-colors <%= article.failed? ? 'border-red-300 bg-red-50 dark:border-red-800 dark:bg-red-950' : 'border-default hover:border-strong' %>">
  <% if article.pending? %>
    <div class="animate-pulse space-y-3">
      <div class="h-6 surface-hover rounded w-3/4"></div>
      <div class="h-4 surface-alt rounded w-1/2"></div>
    </div>
    <p class="text-sm text-faint mt-3 overflow-hidden"><%= article.url %></p>
  <% elsif article.failed? %>
    <h2 class="text-xl font-semibold text-red-700 dark:text-red-400">Failed to process</h2>
    <p class="text-sm text-red-600 dark:text-red-500 mt-1"><%= article.user_friendly_error_message %></p>
    <p class="text-sm text-faint mt-2 truncate"><%= article.url %></p>
    <% if article.parsed_error %>
      <details class="mt-2">
        <summary class="text-xs text-faint cursor-pointer">Technical details</summary>
        <div class="mt-1 text-xs text-faint font-mono">
          <p><%= article.parsed_error[:class] %>: <%= article.parsed_error[:message] %></p>
          <% if article.parsed_error[:occurred_at] %>
            <p class="mt-1">Failed: <%= Time.parse(article.parsed_error[:occurred_at]).strftime("%b %d, %Y %H:%M") %></p>
          <% end %>
        </div>
      </details>
    <% end %>
  <% else %>
    <div class="flex items-start gap-2">
      <%= card_icon(article) %>
      <div class="space-y-1">
        <h2 class="text-xl font-semibold text-heading"><%= link_to article.title.presence || "Untitled", article %></h2>
        <%= render "shared/byline", author: article.author, date: article.published_at %>
      </div>
    </div>

    <% if article.image_url.present? %>
      <div class="hidden md:block h-32 w-48 float-right ml-4 rounded-lg overflow-hidden bg-black/5 dark:bg-white/5 mt-3">
        <%= image_tag article.image_url, class: "w-full h-full object-contain" %>
      </div>
    <% end %>

    <% if article.summary.present? %>
      <p class="text-body mt-3"><%= render_content(article.summary, current_item: article) %></p>
    <% end %>

    <% if show_searches && (visible_searches = article.searches.select(&:complete?)).any? %>
      <div class="clear-both"></div>
      <div class="mt-4 space-y-2">
        <% visible_searches.each do |search| %>
          <%= render search %>
        <% end %>
      </div>
    <% end %>
  <% end %>
</div>

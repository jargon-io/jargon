<%# locals: (article:, similar_items: []) %>

<div class="space-y-4">
  <div class="space-y-1">
    <h1 class="text-3xl font-bold text-heading"><%= article.title %></h1>
    <%= render "shared/byline", author: article.author, date: article.published_at %>
  </div>

  <% if article.video? && (video_id = article.url&.match(YoutubeClient::URL_REGEX)&.[](1)) %>
    <div class="aspect-video mt-4">
      <iframe
      src="https://www.youtube.com/embed/<%= video_id %>"
      class="w-full h-full rounded-lg"
      frameborder="0"
      allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
      allowfullscreen>
      </iframe>
    </div>
  <% elsif article.image_url.present? %>
    <%= image_tag article.image_url, class: "w-full max-h-64 object-contain rounded-lg md:float-right md:w-auto md:max-w-64 md:max-h-48 md:ml-4 md:mb-4 mt-4" %>
  <% end %>

  <% if article.summary.present? %>
    <p class="text-lg text-body leading-relaxed mt-4"><%= render_content(article.summary, current_item: article) %></p>
  <% end %>

  <% if article.has_children? %>
    <ul class="mt-4">
      <% article.children.each do |child| %>
        <% next if child.url.blank? %>
        <li><%= link_to child.url, child.url, class: "text-link" %></li>
      <% end %>
    </ul>
  <% elsif article.url.present? && !article.video? %>
    <div class="mt-4">
      <% label = article.paper? ? "Read original paper" : "Read original" %>
      <%= link_to label,
            article.url,
            rel: "noopener",
            class: "text-link font-medium" %>
    </div>
  <% end %>

  <% rolled_up = article.rolled_up_insights %>
  <% generating = article.text.present? && article.updated_at > 1.minute.ago %>

  <% if rolled_up.any? %>
    <div class="pt-4">
      <%= render "shared/expandable_list", items: rolled_up do |insight| %>
        <%= render insight, suppress_source: true %>
      <% end %>
    </div>
  <% elsif generating %>
    <div class="pt-4">
      <%= render "shared/loading_placeholder", id: "insights_loading", message: "Generating insights..." %>
    </div>
  <% end %>

  <%= render "shared/section_heading", title: "Explore" %>

  <%= render "searches/explore", source: article, searches: article.searches %>

  <% if similar_items.any? %>
    <%= render "shared/section_heading", title: "Related" %>
    <%= render "shared/expandable_list", items: similar_items do |item| %>
      <%= render "shared/item", item: item %>
    <% end %>
  <% end %>
</div>

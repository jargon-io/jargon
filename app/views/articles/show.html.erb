<%= turbo_stream_from "article_#{@article.id}_insights" %>

<div class="w-full max-w-2xl mx-auto space-y-4">
  <div>
    <h1 class="text-3xl font-bold"><%= @article.title %></h1>
    <%= render "shared/byline", author: @article.author, date: @article.published_at %>
  </div>

  <% if @article.video? && (video_id = @article.url&.match(YoutubeClient::URL_REGEX)&.[](1)) %>
    <div class="aspect-video">
      <iframe
        src="https://www.youtube.com/embed/<%= video_id %>"
        class="w-full h-full rounded-lg"
        frameborder="0"
        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
        allowfullscreen>
      </iframe>
    </div>
  <% elsif @article.image_url.present? %>
    <%= image_tag @article.image_url, class: "max-w-64 max-h-48 object-contain float-right ml-4 mb-4" %>
  <% end %>

  <% if @article.summary.present? %>
    <p class="text-lg text-gray-700 leading-relaxed"><%= safe_html(@article.summary) %></p>
  <% end %>

  <% unless @article.video? %>
    <div>
      <% label = @article.paper? ? "Read original paper" : "Read original" %>
      <%= link_to label,
              @article.url,
              target: "_blank",
              rel: "noopener",
              class: "text-blue-500 hover:text-blue-600 font-medium" %>
    </div>
  <% end %>

  <div id="insights" class="space-y-4">
    <% if @article.insights.complete.any? %>
      <%= render @article.insights.complete, suppress_source: true %>
    <% elsif @article.text.present? && @article.updated_at > 1.minute.ago %>
      <%= render "shared/loading_placeholder", id: "insights_loading", message: "Generating insights..." %>
    <% end %>
  </div>

  <% if @similar_items.any? %>
    <%= render "shared/section_heading", title: "Related" %>
    <%= render partial: "shared/item", collection: @similar_items, as: :item %>
  <% end %>
</div>

<%= turbo_stream_from "article_#{@article.id}_insights" %>

<div class="w-full max-w-2xl mx-auto space-y-4">
  <h1 class="text-3xl font-bold mb-4"><%= @article.title %></h1>

  <div class="text-sm text-gray-500 mb-6 flex items-center gap-4">
    <% if @article.author.present? %>
      <span>By <%= @article.author %></span>
    <% end %>
    <% if @article.published_at.present? %>
      <span><%= @article.published_at.to_date %></span>
    <% end %>
  </div>

  <% if @article.image_url.present? %>
    <%= image_tag @article.image_url,
            alt: @article.title,
            class: "w-64 float-right ml-4 mb-4" %>
  <% end %>

  <% if @article.summary.present? %>
    <p class="text-lg text-gray-700 leading-relaxed"><%= @article.summary %></p>
  <% end %>

  <div>
    <%= link_to "Read original",
            @article.url,
            target: "_blank",
            rel: "noopener",
            class: "text-blue-500 hover:text-blue-600 font-medium" %>
  </div>

  <h2 id="insights" class="text-2xl font-semibold pt-6 pb-2">Insights</h2>

  <% if @article.insights.complete.any? %>
    <%= render @article.insights.complete, article: @article %>
  <% else %>
    <div id="insights_loading" class="mt-8 mb-4">
      <div class="animate-pulse space-y-3">
        <div class="h-4 bg-gray-200 rounded w-1/3"></div>
        <div class="h-3 bg-gray-100 rounded w-2/3"></div>
      </div>
      <p class="text-sm text-gray-400 mt-2">Generating insights...</p>
    </div>
  <% end %>

  <% if @similar_items.any? %>
    <h2 id="insights" class="text-2xl font-semibold pt-6 pb-2">Related</h2>
    <%= render partial: "shared/item", collection: @similar_items, as: :item %>
  <% end %>
</div>

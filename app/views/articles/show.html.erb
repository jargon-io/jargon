<%= turbo_stream_from "article_#{@article.id}_insights" %>

<div class="w-full max-w-2xl mx-auto">
  <% if @article.pending? %>
    <div class="text-center py-12">
      <div class="animate-pulse">
        <div class="h-8 bg-gray-200 rounded w-3/4 mx-auto mb-4"></div>
        <div class="h-4 bg-gray-200 rounded w-1/2 mx-auto"></div>
      </div>
      <p class="text-gray-500 mt-6">Processing article...</p>
    </div>
  <% elsif @article.failed? %>
    <div class="text-center py-12">
      <div class="text-red-500 mb-4">
        <svg class="w-16 h-16 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
        </svg>
      </div>
      <h1 class="text-2xl font-bold text-red-700 mb-2">Failed to process</h1>
      <p class="text-gray-500 mb-6"><%= @article.url %></p>
      <%= link_to "Back", root_path, class: "text-blue-600 hover:text-blue-800" %>
    </div>
  <% else %>
    <article>
      <h1 class="text-3xl font-bold mb-4"><%= @article.title %></h1>

      <div class="text-sm text-gray-500 mb-6 flex items-center gap-4">
        <% if @article.author.present? %>
          <span>By <%= @article.author %></span>
        <% end %>
        <% if @article.published_at.present? %>
          <span><%= @article.published_at.to_date %></span>
        <% end %>
      </div>

      <% if @article.image_url.present? %>
        <%= image_tag @article.image_url,
            alt: @article.title,
            class: "w-64 float-right ml-4 mb-4" %>
      <% end %>

      <% if @article.summary.present? %>
        <p class="text-lg text-gray-700 leading-relaxed mb-6"><%= @article.summary %></p>
      <% end %>

      <div class="flex items-center gap-4 pb-4 mb-2 border-b border-gray-200 clear-both">
        <%= link_to "Read original",
            @article.url,
            target: "_blank",
            rel: "noopener",
            class: "text-blue-600 hover:text-blue-800 font-medium" %>
        <span class="text-gray-300">|</span>
        <%= link_to "Back", root_path, class: "text-gray-500 hover:text-gray-700" %>
      </div>

      <div class="mb-6 clear-both">
        <div id="insights" class="space-y-1">
          <% if @article.insights.complete.any? %>
            <%= render @article.insights.complete, expanded: true %>
          <% else %>
            <div id="insights_loading" class="mt-8 mb-4">
              <div class="animate-pulse space-y-3">
                <div class="h-4 bg-gray-200 rounded w-1/3"></div>
                <div class="h-3 bg-gray-100 rounded w-2/3"></div>
              </div>
              <p class="text-sm text-gray-400 mt-2">Generating insights...</p>
            </div>
          <% end %>
        </div>
      </div>

      <% if @similar_articles.any? %>
        <div class="pt-2">
          <h2 class="text-lg font-semibold mb-4">Similar Articles</h2>
          <div class="space-y-4">
            <%= render @similar_articles %>
          </div>
        </div>
      <% end %>
    </article>
  <% end %>
</div>

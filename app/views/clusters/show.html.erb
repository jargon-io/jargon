<% content_for(:title) { "#{@cluster.name.presence || 'Cluster'} | Jargon" } %>
<div class="w-full max-w-2xl mx-auto space-y-4">
  <h1 class="text-3xl font-bold"><%= @cluster.name.presence || "Unnamed Cluster" %></h1>

  <% if @cluster.image_url.present? %>
    <%= image_tag @cluster.image_url, class: "float-right ml-4 mb-4 max-h-48 max-w-64 object-contain rounded" %>
  <% end %>

  <% if @cluster.clusterable_type == "Insight" %>
    <% if @cluster.body.present? %>
      <p class="text-lg text-gray-700 leading-relaxed"><%= render_content(@cluster.body, current_item: @cluster) %></p>
    <% end %>

    <%= render "shared/snippet", text: @cluster.snippet, current_item: @cluster %>

    <% if @source_items.any? %>
      <div class="space-y-4 clear-both pt-4" data-controller="expandable-list" data-expandable-list-limit-value="3">
        <% @source_items.each do |item| %>
          <div data-expandable-list-target="item">
            <%= render "shared/item", item: item %>
          </div>
        <% end %>
        <%= render "shared/expandable_toggle" %>
      </div>
    <% end %>
  <% else %>
    <% if @cluster.summary.present? %>
      <p class="text-lg text-gray-700 leading-relaxed"><%= render_content(@cluster.summary, current_item: @cluster) %></p>
    <% end %>

    <% if @cluster.snippet.present? %>
      <%= render "shared/snippet", text: @cluster.snippet, current_item: @cluster %>
    <% end %>

    <ul class="text-blue-500 text-sm space-y-1 clear-both">
      <% @members.each do |article| %>
        <li>
          <%= link_to article.url, article.url, target: "_blank", rel: "noopener", class: "hover:underline break-all" %>
        </li>
      <% end %>
    </ul>

    <% if @insights.any? %>
      <div class="space-y-4 pt-4" data-controller="expandable-list" data-expandable-list-limit-value="3">
        <% @insights.each do |item| %>
          <div data-expandable-list-target="item">
            <%= render "shared/item", item: item, suppress_source: true %>
          </div>
        <% end %>
        <%= render "shared/expandable_toggle" %>
      </div>
    <% end %>
  <% end %>

  <% if @similar_items.any? %>
    <%= render "shared/section_heading", title: "Related" %>
    <div class="space-y-4" data-controller="expandable-list" data-expandable-list-limit-value="3">
      <% @similar_items.each do |item| %>
        <div data-expandable-list-target="item">
          <%= render "shared/item", item: item %>
        </div>
      <% end %>
      <%= render "shared/expandable_toggle" %>
    </div>
  <% end %>
</div>

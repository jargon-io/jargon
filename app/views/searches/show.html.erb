<% content_for(:title) { "#{@search.query.truncate(50)} | Jargon" } %>
<%= turbo_stream_from "search_#{@search.id}" %>

<div class="w-full max-w-2xl mx-auto space-y-4">
  <%= render "searches/search", search: @search, hero: true %>

  <div id="search_summary">
    <% if @search.complete? %>
      <%= render "searches/summary", search: @search %>
    <% else %>
      <%= render "shared/loading_placeholder", id: "summary_loading", message: "Gathering insights..." %>
    <% end %>
  </div>

  <% if @search.source %>
    <%= render "shared/section_heading", title: "Source" %>
    <%= render "shared/item", item: @search.source %>
  <% end %>

  <%= render "shared/section_heading", title: "Results" %>
  <div id="search_results" class="space-y-4">
    <% @result_articles.each do |article| %>
      <%= render "articles/article", article: %>
    <% end %>
    <% if @search.searching? && @result_articles.empty? %>
      <%= render "shared/loading_placeholder", id: "results_loading", message: "Searching..." %>
    <% elsif @search.complete? && @result_articles.empty? %>
      <p class="text-muted">No results found.</p>
    <% end %>
  </div>

  <% if @result_insights.any? %>
    <div data-controller="expandable-list" data-expandable-list-limit-value="0">
      <% @result_insights.each do |insight| %>
        <div data-expandable-list-target="item" class="mt-4">
          <%= render insight, suppress_source: true %>
        </div>
      <% end %>
      <%= render "shared/expandable_toggle", label: "Show insights" %>
    </div>
  <% end %>

  <%= render "shared/section_heading", title: "Explore" %>
  <div id="search_explore">
    <% if @search.complete? %>
      <%= render "searches/explore", source: @search, searches: @search.searches %>
    <% else %>
      <%= render "shared/loading_placeholder", id: "explore_loading", message: "Gathering insights..." %>
    <% end %>
  </div>

  <% if @related_items.any? %>
    <%= render "shared/section_heading", title: "Related" %>
    <div class="space-y-4" data-controller="expandable-list">
      <% @related_items.each do |item| %>
        <div data-expandable-list-target="item">
          <%= render "shared/item", item: item %>
        </div>
      <% end %>
      <%= render "shared/expandable_toggle" %>
    </div>
  <% end %>
</div>
